<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{fragments/layout :: head(${pageTitle})}"></head>
  <body>
    <header th:replace="~{fragments/layout :: header}"></header>
    <main class="container manage-watchlist">
      <section class="page-header">
        <h1>관심 코인 관리</h1>
        <p>CoinGecko 시세를 기반으로 홈 대시보드에 노출될 개인 맞춤형 시세판을 구성합니다.</p>
      </section>

      <div th:if="${successMessage != null}" class="flash-info" th:text="${successMessage}"></div>

      <div class="manage-watchlist__grid">
        <section class="manage-watchlist__form">
          <h2>관심 코인 추가</h2>
          <form th:action="@{/watchlist/manage/add}" method="post" th:object="${addForm}">
            <div class="form-group" th:classappend="${#fields.hasErrors('coinId')} ? ' has-error'">
              <label for="coinId">CoinGecko 코인 ID</label>
              <input id="coinId" type="text" th:field="*{coinId}" placeholder="예: bitcoin, ethereum" />
              <p class="form-error" th:if="${#fields.hasErrors('coinId')}" th:errors="*{coinId}"></p>
            </div>
            <div class="form-group">
              <label for="label">표시 이름 (선택)</label>
              <input id="label" type="text" th:field="*{label}" placeholder="나만의 이름으로 표시" />
            </div>
            <div class="form-error" th:if="${#fields.hasGlobalErrors()}">
              <p th:each="err : ${#fields.globalErrors()}" th:text="${err.defaultMessage}"></p>
            </div>
            <button type="submit" class="button">추가하기</button>
          </form>
          <div class="manage-watchlist__hint">
            <p>CoinGecko ID는 <strong>https://www.coingecko.com</strong> 코인 상세 페이지 URL의 마지막 슬러그와 동일합니다.</p>
            <p>예) <code>https://www.coingecko.com/en/coins/bitcoin</code> → <strong>bitcoin</strong></p>
          </div>
          <div class="manage-watchlist__defaults" th:if="${defaultCoins != null && !defaultCoins.isEmpty()}">
            <h3>추천 기본 코인</h3>
            <ul>
              <li th:each="coin : ${defaultCoins}">
                <span th:text="${coin.label != null ? coin.label : coin.coinId}"></span>
                <code th:text="${coin.coinId}"></code>
              </li>
            </ul>
          </div>
        </section>

        <section class="manage-watchlist__list">
          <h2>내 관심 코인</h2>
          <div th:if="${entries == null || entries.isEmpty()}" class="empty-state">
            아직 추가한 코인이 없습니다. 기본 추천 목록이 홈에서 표시됩니다.
          </div>
          <ul th:if="${entries != null && !entries.isEmpty()}" class="watchlist-entry-list">
            <li th:each="entry, stat : ${entries}">
              <div>
                <strong th:text="${entry.label != null ? entry.label : entry.coinId}"></strong>
                <span class="watchlist-entry__id" th:text="${entry.coinId}"></span>
              </div>
              <form
                th:action="@{'/watchlist/manage/' + ${entry.id} + '/delete'}"
                method="post"
                onsubmit="return confirm('해당 코인을 관심 목록에서 제거할까요?');"
              >
                <button type="submit" class="button-secondary button-compact">제거</button>
              </form>
            </li>
          </ul>
        </section>
      </div>

      <section class="manage-watchlist__preview" th:if="${preview != null && !preview.empty}">
        <div class="manage-watchlist__preview-header">
          <h2>미리보기</h2>
          <p>홈 화면에는 아래와 같이 표시됩니다.</p>
        </div>
        <div th:replace="~{fragments/watchlist :: table(${preview})}"></div>
      </section>
    </main>
    <footer th:replace="~{fragments/layout :: footer}"></footer>
  </body>
</html>
