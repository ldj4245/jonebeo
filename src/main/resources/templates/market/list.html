<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{fragments/layout :: head(${pageTitle})}"></head>
  <body>
    <header th:replace="~{fragments/layout :: header}"></header>
    <main class="container">
      <section class="market-hero">
        <div>
          <h1>실시간 코인 시세</h1>
          <p class="subtitle">
            CoinGecko 데이터를 기반으로 상위 코인들의 가격, 시가총액, 거래량을 확인하세요.
          </p>
        </div>
        <div class="market-meta">
          <span th:text="${'통화: ' + vsCurrency}"></span>
          <span th:text="${'페이지: ' + page}"></span>
          <span th:text="${'표시 수: ' + size}"></span>
        </div>
      </section>

      <section>
        <div class="market-table-wrapper" th:if="${!#lists.isEmpty(coins)}">
          <table class="market-table">
            <thead>
              <tr>
                <th>#</th>
                <th>코인</th>
                <th>현재가</th>
                <th>24h 변동</th>
                <th>시가총액</th>
                <th>24h 거래대금</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="coin,stat : ${coins}">
                <td th:text="${(page - 1) * size + stat.index + 1}"></td>
                <td>
                  <a th:href="@{'/coins/' + ${coin.id}}" class="market-coin-link">
                    <img th:src="${coin.image}" th:alt="${coin.name}" />
                    <div>
                      <div th:text="${coin.name}"></div>
                      <small th:text="${#strings.toUpperCase(coin.symbol)}"></small>
                    </div>
                  </a>
                </td>
                <td th:text="${coin.currentPrice == null ? '-' : #numbers.formatDecimal(coin.currentPrice, 0, 'COMMA', 2, 'POINT') + ' ' + vsCurrency}"></td>
                <td
                  th:classappend="${coin.priceChangePercentage24h != null && coin.priceChangePercentage24h >= 0} ? ' is-up' : ' is-down'"
                  th:text="${coin.priceChangePercentage24h == null ? '-' : #numbers.formatDecimal(coin.priceChangePercentage24h, 1, 'COMMA', 2, 'POINT') + '%'}"
                ></td>
                <td th:text="${coin.marketCap == null ? '-' : #numbers.formatDecimal(coin.marketCap, 0, 'COMMA', 0, 'POINT') + ' ' + vsCurrency}"></td>
                <td th:text="${coin.totalVolume == null ? '-' : #numbers.formatDecimal(coin.totalVolume, 0, 'COMMA', 0, 'POINT') + ' ' + vsCurrency}"></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="empty-state" th:if="${#lists.isEmpty(coins)}">
          데이터를 불러오지 못했습니다. 잠시 후 다시 시도해주세요.
        </div>
      </section>
    </main>
    <footer th:replace="~{fragments/layout :: footer}"></footer>
  </body>
</html>
